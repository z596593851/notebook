# 主从复制

基于BinLog的Replication

-   速度快
-   从节点只读
-   异步复制
-   弱一致性（因为复制不同步）
-   master宕机，slaver不会自动升级成master

适用于价值不高的数据，如日志、帖子等。

[https://www.jianshu.com/p/faf0127f1cb2](https://www.jianshu.com/p/faf0127f1cb2)

  

PXC

-   同步复制（真正意义上的同步） 
-   强一致性
-   任意节点读写
-   只支持InnoDB引擎
-   写入效率取决于最弱的那一台
-   所有表必须都有主键

适用于一致性要求较高的数据，如订单、账户、财务。

首先客户端先发起一个事务，该事务先在本地执行，执行完成之后就要发起对事务的提交操作了。在提交之前需要将产生的复制写集广播出去，然后获取到一个全局的事务ID号，一并传送到另一个节点上面。通过合并数据之后，发现没有冲突数据，执行apply\_cd和commit\_cb动作，否则就需要取消此次事务的操作。而当前server节点通过验证之后，执行提交操作，并返回OK，如果验证没通过，则执行回滚。当然在生产中至少要有3个节点的集群环境，如果其中一个节点没有验证通过，出现了数据冲突，那么此时采取的方式就是讲出现不一致的节点踢出集群环境，而且它自己会执行shutdown命令，自动关机。