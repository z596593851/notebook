![[Pasted image 20211012171516.png]]
![[Pasted image 20211012165047.png]]
![[Pasted image 20211014162615.png]]
![[Pasted image 20220330232024.png]]

MyBatis 的运行期执行，是我们通过操作 `SqlSession` 的方法，底层由 `Executor` 实际负责工作。
`SqlSession` 会根据查询的 `statementId` 找出对应的 `MappedStatement` ，之后交予 `Executor` 继续后面的工作

解析mapper.xml中的 select 、insert 、update 、delete 标签并最终封装为一个一个的 MappedStatement
### SqlSessionFactory
解析xml中的数据库连接配置、类型处理器等，解析mapper的crud、resultmap等信息
创建事务
创建Executor->给Executor包装二级缓存->给Executor执行拦截器增强
创建SqlSession
### SqlSession
![[Pasted image 20211015185821.png]]
解析mapper.xml中的 select 、insert 、update 、delete 标签并最终封装为一个一个的 MappedStatement
将MappedStatement 和参数交给Executor，执行相应的query或update方法
### Executor
![[Pasted image 20211015191937.png]]
通过MappedStatement获取要执行查询的SQL——解析sqlnode（if where等）,解析#{}占位符
处理一级缓存
SimpleExecutor
创建StatementHandler(PreparedStatementHandler)->拦截器增强StatementHandler->创建PreparedStatement->将PreparedStatement交给StatementHandler处理
#### StatementHandler
PreparedStatementHandler
使用 **ParameterHandler** 给PreparedStatement设置参数
执行PreparedStatement.execute
ResultSetHandler处理结果集
### ResultSetHandler
将ResultSet封装为ResultSetWrapper->MappedStatement中获取ResultMap->两者取值映射放入新建的空对象List中
如果调用的是Sqlsession中的selectMap，那么这个list会传入ResultHandler中处理
### ResultHandler
