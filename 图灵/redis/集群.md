访问瞬断可以一定程度缓解。主从结构的redis当主节点挂掉，从节点还没来得及顶上时，整个redis服务处于不可用状态；但集群结构的redis当某个主节点挂掉从节点顶上前，也只会影响这个节点内的数据访问。
![[Pasted image 20220725205835.png]]

节点最好不超过1000

集群可以提高qps

集群分片
![[Pasted image 20220725210908.png]]
![[Pasted image 20220725211051.png]]
![[Pasted image 20220725211304.png]]

即使在当前机器set值，也可能被存入其他机器：
![[Pasted image 20220725212028.png]]
但是取值时不能直接从物理机上取，可能取不到，需要用jedis或者spring-redis。jedis客户端在初始化时会缓存一份集群的槽位-ip对照关系表，在执行get、set命令时会通过计算key的hash值与16384取模，然后根据关系表去对应的机器上进行操作。

集群之间的数据同步方式有两种，集中存储（如借助zk）和gossip：
集中式的优点是同步快，缺点是压力集中在了一个地方
gossip的优点在于数据比较分散，降低了压力；缺点是有延迟，非强一致，最终一致
![[Pasted image 20220725214343.png]]

由于redis是gossip式，所以集群不建议搞太多节点，容易导致延迟。redis集群内部通信端口是对外端口+10000

集群选举过程
![[Pasted image 20220725215456.png]]
![[Pasted image 20220725215910.png]]

CAP：一致性、可用性、分区性，redes是AP架构，zk是CP架构

集群脑裂
![[Pasted image 20220726203742.png]]
缺点是，如果一个集群的主节点超过半数的从节点挂掉，那么这个集群就不可用了。这就相当于牺牲了可用性来换取一致性。

![[Pasted image 20220726204729.png]]