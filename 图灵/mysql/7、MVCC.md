# MVCC
MVCC是靠undo log（回滚日志）实现的，当事务对数据进行修改后，mysql会保存修改前的回滚日志，并用两个隐藏字段trx_id（当前事务id）和roll_pointer（上一版本的事务id）把这些undo日志串联起来形成一个历史记录版本链。

在可重复读隔离级别，当事务开启，执行任何查询sql时会生成当前事务的一致性视图read-view，该视图在事务结束之前都不会变化（如果是读已提交隔离级别在每次执行查询sql时都会重新生成），这个视图由执行查询时所有未提交事务id组成，同时还会记录read-view中的最小事务id（min_id），和当前所有事务中的最大事务id（max_id），事务里的任何sql查询结果都需要从对应undo版本链里的最新事务id开始逐条跟read-view做比对，如果该事务id小于min_id，说明该事务已经提交，可见；如果大于max_id，说明该事务是未来开始的，不可见；如果该事务id存在于read-view中，不可见；否则可见。

![[Pasted image 20220128222553.png]]

![[Pasted image 20220128222301.png]]
